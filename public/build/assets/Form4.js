import S from"./SupplierSelect.js";import{_ as x,L as g,o as p,B as D,C as i,a as s,G as o,D as r,a5 as n,c as y,F as v,e as w,a6 as j,H as M}from"./id.js";import{E as U}from"./index21.js";import{E as Y,a as B}from"./index23.js";import{E as F}from"./index8.js";import{E as L}from"./index37.js";import{E as N}from"./index9.js";import{E as O}from"./index38.js";import{E as H,a as I}from"./index32.js";import{E as z}from"./index25.js";import"./index33.js";import"./index22.js";import"./typescript.js";import"./event.js";import"./index31.js";import"./scroll.js";import"./isEqual.js";import"./_Uint8Array.js";import"./debounce.js";import"./index34.js";import"./validator.js";import"./index7.js";import"./_initCloneObject.js";import"./index24.js";import"./index26.js";const A={components:{SupplierSelect:S},props:{data:{type:Object,default:{}},errors:Object},data(){return{title:"Tambah Pesanan Pembelian",query:"",loading:!1,form:{id:null,nomor:null,supplier_id:null,date:null,total:0},lines:[],lines_deleted:[]}},created(){Object.keys(this.data).length&&this.setValue()},methods:{selectProduct(e){if(this.lines.length>=1)if(this.lines.some(d=>d.variant_id===e.id))for(var t=0;t<this.lines.length;t++)this.lines[t].variant_id===e.id&&this.lines[t].qty++;else this.lines.push({id:null,variant_id:e.id,product_id:e.product_id,variant:e.name,product:e.product,qty:1,price:e.purchase_price,unit_id:e.purchase_unit_id});else this.lines.push({id:null,variant_id:e.id,product_id:e.product_id,variant:e.name,product:e.product,qty:1,price:e.purchase_price,unit_id:e.purchase_unit_id});this.calculateTotal(),this.$forceUpdate()},async findProduct(e){try{this.isLoading=!0;const t=await axios.get("/admin/produk/search",{params:{q:e}});if(t.status==200)return t.data;this.isLoading=!1}catch(t){console.error(t)}},removeLine(e,t){t&&this.lines_deleted.push(t),this.lines.splice(e,1),this.calculateTotal(),this.$forceUpdate()},submit(){this.loading=!0;let e=Object.assign(this.form,{lines:this.lines,lines_deleted:this.lines_deleted}),t=this.$inertia.form(e),d=Object.keys(this.data).length?this.route("admin.purchase.order.update",{id:this.data.id}):this.route("admin.purchase.order.store");t.post(d,{preserveScroll:!0,onSuccess:()=>{U({type:"success",message:"Data Berhasil Disimpan!"})},onFinish:()=>{this.loading=!1}})},setValue(){this.title="Ubah Pesanan Pembelian",this.form.id=this.data.id,this.form.nomor=this.data.nomor,this.form.supplier_id=this.data.supplier_id,this.form.date=this.data.date,this.form.total=this.data.total,this.data.lines.forEach((e,t)=>{this.lines.push({id:e.id,product:e.product.name,variant:e.variant.name,variant_id:e.variant_id,product_id:e.product_id,price:e.price,qty:e.qty,unit_id:e.unit_id,subtotal:e.subtotal})})},calculateTotal(){let e=0;for(var t=0;t<this.lines.length;t++)this.lines[t].subtotal=this.lines[t].qty*this.lines[t].price,e+=this.lines[t].subtotal;this.form.total=e}}},G={class:"content"},Q={class:"content-heading d-flex justify-content-between align-items-center pt-0"},R={class:"space-x-1"},J=s("i",{class:"fa fa-check me-2"},null,-1),K={class:"block block-rounded"},W={class:"block-content p-4"},X=s("span",null,[s("i",{class:"fa fa-search"})],-1),Z=s("i",{class:"fa fa-times"},null,-1),$={class:"d-flex float-end justify-content-end w-75 fs-4"},ee=s("div",{class:""},"Total",-1),te={class:"text-end w-50"};function le(e,t,d,oe,a,u){const _=M,E=g("supplier-select"),f=Y,m=F,k=L,h=N,V=O,c=H,q=z,P=I,T=B,C=g("base-layout");return p(),D(C,null,{default:i(()=>[s("div",G,[o(T,{"label-width":"30%",onSubmit:j(u.submit,["prevent"]),"label-position":"top"},{default:i(()=>[s("div",Q,[s("span",null,r(a.title),1),s("div",R,[o(_,{"native-type":"submit",type:"primary",loading:a.loading},{default:i(()=>[J,n(" Simpan ")]),_:1},8,["loading"])])]),s("div",K,[s("div",W,[o(h,{gutter:32},{default:i(()=>[o(m,{lg:12},{default:i(()=>[o(f,{class:"mb-4",label:"Supplier",error:d.errors.name},{default:i(()=>[o(E,{modelValue:a.form.supplier_id,"onUpdate:modelValue":t[0]||(t[0]=l=>a.form.supplier_id=l)},null,8,["modelValue"])]),_:1},8,["error"])]),_:1}),o(m,{lg:12},{default:i(()=>[o(f,{class:"mb-4",label:"Tanggal",error:d.errors.email},{default:i(()=>[o(k,{modelValue:a.form.date,"onUpdate:modelValue":t[1]||(t[1]=l=>a.form.date=l),type:"date",class:"w-100",placeholder:"Pilih Tanggal",format:"DD MMMM YYYY","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1}),o(V,{modelValue:a.query,"onUpdate:modelValue":t[2]||(t[2]=l=>a.query=l),"fetch-suggestions":u.findProduct,clearable:"","trigger-on-focus":!1,class:"inline-input w-50 mb-3",placeholder:"Cari Produk",onSelect:u.selectProduct},{default:i(({item:l})=>[s("div",null,[n(r(l.product)+" ",1),l.product?(p(),y(v,{key:0},[n(" - "+r(l.name),1)],64)):w("",!0)]),s("div",null,r(l.sku),1)]),prefix:i(()=>[X]),_:1},8,["modelValue","fetch-suggestions","onSelect"]),o(P,{data:a.lines,border:"",class:"mb-4",id:"variant"},{default:i(()=>[o(c,{label:"Produk"},{default:i(l=>[s("div",null,[n(r(l.row.product)+" ",1),l.row.product?(p(),y(v,{key:0},[n(" - "+r(l.row.variant),1)],64)):w("",!0)]),s("div",null,r(l.row.sku),1)]),_:1}),o(c,{label:"Harga"},{default:i(l=>[n(r(e.currency(l.row.price)),1)]),_:1}),o(c,{label:"Qty"},{default:i(l=>[o(q,{modelValue:l.row.qty,"onUpdate:modelValue":b=>l.row.qty=b,min:1,onChange:u.calculateTotal},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(c,{label:"Total"},{default:i(l=>[n(r(e.currency(l.row.price*l.row.qty)),1)]),_:1}),o(c,{width:"60px",align:"center"},{default:i(l=>[o(_,{type:"danger",size:"small",onClick:b=>u.removeLine(l.$index,l.row.id)},{default:i(()=>[Z]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(h,{justify:"end"},{default:i(()=>[o(m,{lg:12,class:"float-end"},{default:i(()=>[s("div",$,[ee,s("div",te,r(e.currency(a.form.total)),1)])]),_:1})]),_:1})])])]),_:1},8,["onSubmit"])])]),_:1})}const Se=x(A,[["render",le]]);export{Se as default};
